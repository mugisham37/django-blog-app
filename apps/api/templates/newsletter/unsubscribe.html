{% extends 'base.html' %}
{% load static %}

{% block title %}Unsubscribe from Newsletter - {{ block.super }}{% endblock %}

{% block extra_css %}
<style>
    .unsubscribe-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 3rem 2rem;
        text-align: center;
    }
    .unsubscribe-card {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 2rem;
    }
    .unsubscribe-icon {
        font-size: 3rem;
        color: #f39c12;
        margin-bottom: 2rem;
    }
    .subscription-info {
        background-color: #f8f9fa;
        border-radius: 5px;
        padding: 1.5rem;
        margin: 2rem 0;
        text-align: left;
    }
    .btn-unsubscribe {
        background-color: #e74c3c;
        border-color: #e74c3c;
        padding: 0.75rem 2rem;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 5px;
        margin: 0.5rem;
    }
    .btn-unsubscribe:hover {
        background-color: #c0392b;
        border-color: #c0392b;
    }
    .btn-keep {
        background-color: #27ae60;
        border-color: #27ae60;
        padding: 0.75rem 2rem;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 5px;
        margin: 0.5rem;
    }
    .btn-keep:hover {
        background-color: #229954;
        border-color: #229954;
    }
    .reasons-list {
        text-align: left;
        max-width: 400px;
        margin: 0 auto;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="unsubscribe-container">
                <div class="unsubscribe-card">
                    {% if subscription %}
                        <div class="unsubscribe-icon">
                            <i class="fas fa-envelope-open"></i>
                        </div>
                        
                        <h1 class="mb-4">{{ page_title }}</h1>
                        
                        <p class="lead text-muted mb-4">
                            We're sorry to see you go! Before you unsubscribe, let us know if there's anything we can do better.
                        </p>
                        
                        <div class="subscription-info">
                            <h5><i class="fas fa-info-circle me-2"></i>Your Subscription</h5>
                            <p class="mb-2"><strong>Email:</strong> {{ subscription.email }}</p>
                            {% if subscription.full_name %}
                                <p class="mb-2"><strong>Name:</strong> {{ subscription.full_name }}</p>
                            {% endif %}
                            <p class="mb-0"><strong>Subscribed:</strong> {{ subscription.created_at|date:"F j, Y" }}</p>
                        </div>
                        
                        <div class="mt-4 mb-4">
                            <h5>What you'll miss:</h5>
                            <ul class="reasons-list list-unstyled">
                                <li class="mb-2"><i class="fas fa-times text-danger me-2"></i>Latest blog posts and articles</li>
                                <li class="mb-2"><i class="fas fa-times text-danger me-2"></i>Exclusive tips and insights</li>
                                <li class="mb-2"><i class="fas fa-times text-danger me-2"></i>Product updates and announcements</li>
                                <li class="mb-2"><i class="fas fa-times text-danger me-2"></i>Curated content recommendations</li>
                            </ul>
                        </div>
                        
                        <div class="alert alert-warning" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Are you sure?</strong> Once you unsubscribe, you'll need to sign up again to receive our updates.
                        </div>
                        
                        <form method="post" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger btn-unsubscribe">
                                <i class="fas fa-unlink me-2"></i>Yes, Unsubscribe Me
                            </button>
                        </form>
                        
                        <a href="{% url 'blog:post_list' %}" class="btn btn-success btn-keep">
                            <i class="fas fa-heart me-2"></i>Keep My Subscription
                        </a>
                        
                        <div class="mt-4">
                            <p class="text-muted small">
                                <i class="fas fa-shield-alt me-1"></i>
                                We respect your privacy and will never share your email with third parties.
                            </p>
                        </div>
                        
                    {% else %}
                        <div class="unsubscribe-icon">
                            <i class="fas fa-exclamation-triangle text-danger"></i>
                        </div>
                        
                        <h1 class="mb-4">Invalid Unsubscribe Link</h1>
                        
                        <div class="alert alert-danger" role="alert">
                            <h5><i class="fas fa-times-circle me-2"></i>Link Not Found</h5>
                            <p class="mb-0">
                                The unsubscribe link you used is invalid or has expired. 
                                This could happen if the link was corrupted or you've already unsubscribed.
                            </p>
                        </div>
                        
                        <p class="text-muted">
                            If you're still receiving emails and want to unsubscribe, you can use our manual unsubscribe form.
                        </p>
                        
                        <a href="{% url 'newsletter:unsubscribe_form' %}" class="btn btn-primary btn-unsubscribe">
                            <i class="fas fa-edit me-2"></i>Manual Unsubscribe
                        </a>
                        
                        <a href="{% url 'core:home' %}" class="btn btn-secondary">
                            <i class="fas fa-home me-2"></i>Go to Homepage
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const unsubscribeForm = document.querySelector('form[method="post"]');
    if (unsubscribeForm) {
        const submitBtn = unsubscribeForm.querySelector('button[type="submit"]');
        const originalBtnText = submitBtn.innerHTML;
        
        unsubscribeForm.addEventListener('submit', function(e) {
            const confirmed = confirm('Are you sure you want to unsubscribe from our newsletter?');
            if (!confirmed) {
                e.preventDefault();
                return false;
            }
            
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Unsubscribing...';
        });
    }
});
</script>
{% endblock %}